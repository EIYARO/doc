# Eiyaro trading instructions (account management mode)
This section focuses on users sending trades using Eiyaro's own account mode

* [1. Build the Transaction](#1.BuildtheTransaction)

  [action profile](#actionprofile)
  - [issue](#issue)
  - [spend_account](#spend_account)
  - [spend_account_unspent_output](#spend_account_unspent_output)
  - [control_address](#control_address)
  - [control_program](#control_program)
  - [retire](#retire)

  [estimate_handling_fee](#estimate_handling_fee)
* [2, Sign Transaction](#2,SignTransaction)
* [3, submit Transaction](#3,submittransaction)

## 1. build-transaction
API interface build-transaction, code [api/transact.go#L117](https://github.com/EIYARO-Project/core/blob/main/api/transact.go#L117)

As an example, a standard non-EY asset transfer transaction with an asset ID of full F denotes an EY asset, in this example the EY asset is only used as a handling fee, and the transaction denotes spending 99 specific assets into the specified address. Where the input request json format for building the transaction is as follows:
```js
{
  "base_transaction": null,
  "actions": [
    {
      "account_id": "0ER7MEFGG0A02",
      "amount": 20000000,
      "asset_id": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
      "type": "spend_account"
    },
    {
      "account_id": "0ER7MEFGG0A02",
      "amount": 99,
      "asset_id": "42275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f",
      "type": "spend_account"
    },
    {
      "amount": 99,
      "asset_id": "42275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f",
      "address": "sy1qxe4jwhkekgnxkezu7xutu5gqnnpmyc8ppq98me",
      "type": "control_address"
    }
  ],
  "ttl": 0,
  "time_range": 0
}
```

The request objects corresponding to the source code are as follows:
```go
// BuildRequest is main struct when building transactions
type BuildRequest struct {
	Tx        *types.TxData            `json:"base_transaction"`
	Actions   []map[string]interface{} `json:"actions"`
	TTL       json.Duration            `json:"ttl"`
	TimeRange uint64                   `json:"time_range"`
}
```

The structure fields are described below:
- `Tx` The `TxData` portion of the transaction, this field is reserved and empty is sufficient
- `TTL` The time to live (in milliseconds) to build the transaction, meaning that within this timeframe, utxo that has been cached cannot be used to build the transaction again, unless there is enough utxo left to build a new transaction, otherwise an error will be reported. When `ttl` is 0 it is set to 600s by default, i.e. 5 minutes.
- `TimeRange` timestamp, which means that the transaction will not be submitted to the chain after that timestamp (block height), to prevent the transaction from waiting too long due to transmission delays in the network, if the transaction isn't packaged within a specific time range, the transaction will automatically expire
- `Actions` The `actions` structure of a transaction, all transactions are composed of actions, and the `interface{}` of the `map` type ensures the extensibility of the action type. Which action must contain type field, used to distinguish between different action types, `action` mainly contains `input` and `output` two types, its detailed description is as follows:
  - `input action` type:
      - issue issue asset
      - spend_account spend utxo in account mode
      - spend_account_unspent_output Spend the specified utxo directly.
  - `output action` Type:
      - control_address Receive in address mode.
      - control_program Receive in (programme) contract mode.
      - retire Destroy the asset

*Caveat*:
- A transaction must contain at least one input and output (except for coinbase transactions, which are generated by the system and are not described here), otherwise the transaction will report an error.
- Except for EY assets (all trades use EY assets as fees), when constructing inputs and outputs, the sum of all inputs and outputs must be equal, otherwise the trade will report an input/output imbalance error message.
- Fee for the transaction: EY assetamount for all inputs - EY assetamount for all outputs
- The asset count in the transaction is in neu, the unit conversion of EY is as follows: 1 EY = 1000 mEY = 100000000 neu

---

### Introduction to action

The following is a detailed description of the various `action` types used when building transactions:

#### issue
The source code for the `issueAction` structure is shown below:
```go
type issueAction struct {
	assets *Registry
	bc.AssetAmount
}

type AssetAmount struct {
	AssetId *AssetID `protobuf:"bytes,1,opt,name=asset_id,json=assetId" json:"asset_id,omitempty"`
	Amount  uint64   `protobuf:"varint,2,opt,name=amount" json:"amount,omitempty"`
}
```

The structure fields are described below:
- `assets` is mainly used for asset management, no need to set parameter by user.
- `AssetAmount` indicates the asset ID and the corresponding number of assets that the user needs to issue, here the `AssetID` needs to be created by `create-asset`, and the asset ID of `EY` cannot be used here.

The `json` format of `issueAction` is:
```js
{
  "amount": 100000000,
  "asset_id": "3152a15da72be51b330e1c0f8e1c0db669269809da4f16443ff266e07cc43680",
  "type": "issue"
}
```

For example a sample transaction for issuing an asset is shown below:
(This transaction represents the issuance of an asset of `42275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f` in the quantity of `90,000,000` `assetIDs` to the receiving address `) sy1qxe4jwhkekgnxkezu7xutu5gqnnpmyc8ppq98me`, where the handling fee is `20000000` neu's EY assets)
```js
{
  "base_transaction": null,
  "actions": [
    {
      "account_id": "0ER7MEFGG0A02",
      "amount": 20000000,
      "asset_id": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
      "type": "spend_account"
    },
    {
      "amount": 900000000,
      "asset_id": "42275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f",
      "type": "issue"
    },
    {
      "amount": 900000000,
      "asset_id": "42275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f",
      "address": "sy1qxe4jwhkekgnxkezu7xutu5gqnnpmyc8ppq98me",
      "type": "control_address"
    }
  ],
  "ttl": 0,
  "time_range": 0
}
```

---

#### spend_account
The source code for the `spendAction` structure is as follows:
```go
type spendAction struct {
	accounts *Manager
	bc.AssetAmount
	AccountID   string  `json:"account_id"`
	ClientToken *string `json:"client_token"`
}

type AssetAmount struct {
	AssetId *AssetID `protobuf:"bytes,1,opt,name=asset_id,json=assetId" json:"asset_id,omitempty"`
	Amount  uint64   `protobuf:"varint,2,opt,name=amount" json:"amount,omitempty"`
}
```

The structure fields are described below:
- `Accounts` is mainly used for the management of accounts, no need to set parameters by the user
- `AccountID` Indicates the account ID on which the asset is to be spent.
- `AssetAmount` Indicates the ID of the asset to be spent and the corresponding asset amount.
- `ClientToken` indicates the restriction of UTXO for the Reserve user, currently it can be left empty or not filled.

The `json` format of `spendAction` is:
```js
{
  "account_id": "0BF63M2U00A04",
  "amount": 2000000000,
  "asset_id": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
  "type": "spend_account"
}
```

For example a sample transaction to transfer an asset is as follows:
(This transaction means transferring EY assets in the amount of `100000000`neu to the address `sy1qxe4jwhkekgnxkezu7xutu5gqnnpmyc8ppq98me` by means of an account, where the fee of `20000000`neu = the number of input EY assets - the number of output EY assets.)
```js
{
  "base_transaction": null,
  "actions": [
    {
      "account_id": "0ER7MEFGG0A02",
      "amount": 120000000,
      "asset_id": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
      "type": "spend_account"
    },
    {
      "amount": 100000000,
      "asset_id": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
      "address": "sy1qxe4jwhkekgnxkezu7xutu5gqnnpmyc8ppq98me",
      "type": "control_address"
    }
  ],
  "ttl": 0,
  "time_range": 0
}
```

---

#### spend_account_unspent_output
The source code for the `spendUTXOAction` structure is shown below:
```go
type spendUTXOAction struct {
	accounts *Manager
	OutputID *bc.Hash `json:"output_id"`
	ClientToken *string `json:"client_token"`
}
```

The structure fields are described below:
- `accounts` is mainly used for account management, no need for user to set parameters
- `OutputID` indicates the ID of the UTXO that needs to be spent, you can query the available UTXOs according to `list-unspent-outputs`, where `OutputID` corresponds to the `id` field of the result returned by this API.
- `ClientToken` indicates the restriction of Reserve user UTXO, it can be left empty or not filled.

The `json` format of `spendUTXOAction` is:
```js
{
  "type": "spend_account_unspent_output",
  "output_id": "58f29f0f85f7bd2a91088bcbe536dee41cd0642dfb1480d3a88589bdbfd642d9"
}
```

For example, a sample transaction to transfer an asset by spending UTXO is as follows:
(This transaction represents the transfer of EY assets of `100000000`neu directly by spending UTXO to the address `sy1qxe4jwhkekgnxkezu7xutu5gqnnpmyc8ppq98me`, where the fee = the UTXO value of the input EY assets - the number of the output EY assets)
```js
{
  "base_transaction": null,
  "actions": [
    {
      "output_id": "58f29f0f85f7bd2a91088bcbe536dee41cd0642dfb1480d3a88589bdbfd642d9",
      "type": "spend_account_unspent_output"
    },
    {
      "amount": 100000000,
      "asset_id": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
      "address": "sy1qxe4jwhkekgnxkezu7xutu5gqnnpmyc8ppq98me",
      "type": "control_address"
    }
  ],
  "ttl": 0,
  "time_range": 0
}
```

---

#### control_address
The source code for the `controlAddressAction` structure is shown below:
```go
type controlAddressAction struct {
	bc.AssetAmount
	Address string `json:"address"`
}

type AssetAmount struct {
	AssetId *AssetID `protobuf:"bytes,1,opt,name=asset_id,json=assetId" json:"asset_id,omitempty"`
	Amount  uint64   `protobuf:"varint,2,opt,name=amount" json:"amount,omitempty"`
}
```

The structure fields are described below:
- `Address` Indicates the address of the receiving asset, which can be created according to the `create-account-receiver` API interface
- `AssetAmount` Indicates the received asset ID and the corresponding number of assets.

The `json` format of `controlAddressAction` is:
```js
{
  "amount": 100000000,
  "asset_id": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
  "address": "ey1q50u3z8empm5ke0g3ngl2t3sqtr6sd7cepd3z68",
  "type": "control_address"
}
```

For example a sample transaction to transfer an asset is as follows:
(This transaction represents the transfer of EY assets of `100000000`neu by means of an account to the address `sy1qxe4jwhkekgnxkezu7xutu5gqnnpmyc8ppq98me`, where the type `control_address` indicates that the address is used as the means of receipt.)
```js
{
  "base_transaction": null,
  "actions": [
    {
      "account_id": "0ER7MEFGG0A02",
      "amount": 120000000,
      "asset_id": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
      "type": "spend_account"
    },
    {
      "amount": 100000000,
      "asset_id": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
      "address": "sy1qxe4jwhkekgnxkezu7xutu5gqnnpmyc8ppq98me",
      "type": "control_address"
    }
  ],
  "ttl": 0,
  "time_range": 0
}
```

---

#### control_program
The source code for the `controlProgramAction` structure is shown below:
```go
type controlProgramAction struct {
	bc.AssetAmount
	Program json.HexBytes `json:"control_program"`
}

type AssetAmount struct {
	AssetId *AssetID `protobuf:"bytes,1,opt,name=asset_id,json=assetId" json:"asset_id,omitempty"`
	Amount  uint64   `protobuf:"varint,2,opt,name=amount" json:"amount,omitempty"`
}
```

The structure fields are described below:
- `Program` Indicates the contract script for receiving assets, which can be created according to the `create-account-receiver` API interface to receive a `program` (the `program` and `address` of the returned result are one-to-one correspondence)
- `AssetAmount` indicates the received asset ID and the corresponding asset count.

The `json` format of `controlProgramAction` is:
```js
{
  "amount": 100000000,
  "asset_id": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
  "control_program":"0014a3f9111f3b0ee96cbd119a3ea5c60058f506fb19",
  "type": "control_program"
}
```

For example a sample transaction to transfer an asset is as follows:
(This transaction represents the transfer of an EY asset of `100000000`neu by way of an account to the receiving `program` (which is a one-to-one correspondence with `address`) `0014a3f9111f3b0ee96cbd119a3ea5c60058f506fb19`, where the `control_program ` type indicates that `program` is used as the receiving method).
```js
{
  "base_transaction": null,
  "actions": [
    {
      "account_id": "0ER7MEFGG0A02",
      "amount": 120000000,
      "asset_id": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
      "type": "spend_account"
    },
    {
      "amount": 100000000,
      "asset_id": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
      "control_program": "0014a3f9111f3b0ee96cbd119a3ea5c60058f506fb19",
      "type": "control_program"
    }
  ],
  "ttl": 0,
  "time_range": 0
}
```

---

#### retire
The source code for the `retireAction` structure is shown below:
```go
type retireAction struct {
	bc.AssetAmount
	Arbitrary json.HexBytes `json:"arbitrary"`
}

type AssetAmount struct {
	AssetId *AssetID `protobuf:"bytes,1,opt,name=asset_id,json=assetId" json:"asset_id,omitempty"`
	Amount  uint64   `protobuf:"varint,2,opt,name=amount" json:"amount,omitempty"`
}
```

The structure fields are described below:
- `AssetAmount` Indicates the ID of the asset destroyed and the corresponding asset count
- `Arbitrary` Indicates arbitrary additional information (hexadecimal string data), can be empty

The `json` format for `retireAction` is:
```js
{
  "amount": 900000000,
  "asset_id": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
  "arbitrary": "77656c636f6d65efbc8ce6aca2e8bf8ee69da5e588b0e58e9fe5ad90e4b896e7958c",
  "type": "retire"
}
```

For example, a sample transaction for the destruction of an asset is shown below:
(This transaction represents the destruction of the EY assets of `1`neu by means of an account and adds additional information, where `retire' represents the destruction of a specified quantity of assets).
```js
{
  "base_transaction": null,
  "actions": [
    {
      "account_id": "0ER7MEFGG0A02",
      "amount": 900000000,
      "asset_id": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
      "type": "spend_account"
    },
    {
      "amount": 1,
      "asset_id": "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
      "arbitrary": "77656c636f6d65efbc8ce6aca2e8bf8ee69da5e588b0e58e9fe5ad90e4b896e7958c",
      "type": "retire"
    }
  ],
  "ttl": 0,
  "time_range": 0
}
```

---

Once the `build-transaction` input has been constructed, the transaction can be sent via an http call, and the json result returned after a successful build-transaction request is as follows:
```js
{
  "allow_additional_actions": false,
  "fee": 20000000,
  "raw_transaction": "070100020161015f1190c60818b4aff485c865113c802942f29ce09088cae1b117fc4c8db2292212ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8099c4d599010001160014a86c83ee12e6d790fb388345cc2e2b87056a077301000161015fb018097c4040c8dd86d95611a13c24f90d4c9d9d06b25f5c9ed0556ac8abd73442275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f80a094a58d1d0101160014068840e56af74038571f223b1c99f1b60caaf456010003013effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff80bfffcb9901011600140b946646626c55a52a325c8bb48de792284d9b7200013e42275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f9d9f94a58d1d01160014c8b4391bab4923a83b955170d24ee4ca5b6ec3fb00013942275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f6301160014366b275ed9b2266b645cf1b8be51009cc3b260e100",
  "signing_instructions": [
    {
      "position": 0,
      "witness_components": [
        {
          "keys": [
            {
              "derivation_path": [
                "010100000000000000",
                "0100000000000000"
              ],
              "xpub": "de0db655c091b2838ccb6cddb675779b0a9a4204b122e61699b339867dd10eb0dbdc926882ff6dd75c099c181c60d63eab0033a4b0a4d0a8c78079e39d7ad1d8"
            }
          ],
          "quorum": 1,
          "signatures": null,
          "type": "raw_tx_signature"
        },
        {
          "type": "data",
          "value": "d174db6506e35f2decb5be148c2984bfd0f6c67f043365bf642d1af387c04fd5"
        }
      ]
    },
    {
      "position": 1,
      "witness_components": [
        {
          "keys": [
            {
              "derivation_path": [
                "010100000000000000",
                "0800000000000000"
              ],
              "xpub": "de0db655c091b2838ccb6cddb675779b0a9a4204b122e61699b339867dd10eb0dbdc926882ff6dd75c099c181c60d63eab0033a4b0a4d0a8c78079e39d7ad1d8"
            }
          ],
          "quorum": 1,
          "signatures": null,
          "type": "raw_tx_signature"
        },
        {
          "type": "data",
          "value": "05cdbcc705f07ad87521835bbba226ad7b430cc24e5e3f008edbe61540535419"
        }
      ]
    }
  ]
}
```

The source code of the corresponding response object is as follows:
```go
// Template represents a partially- or fully-signed transaction.
type Template struct {
	Transaction         *types.Tx             `json:"raw_transaction"`
	SigningInstructions []*SigningInstruction `json:"signing_instructions"`

	// AllowAdditional affects whether Sign commits to the tx sighash or
	// to individual details of the tx so far. When true, signatures
	// commit to tx details, and new details may be added but existing
	// ones cannot be changed. When false, signatures commit to the tx
	// as a whole, and any change to the tx invalidates the signature.
	AllowAdditional bool `json:"allow_additional_actions"`
}
```

The structure fields are described below:
- `Transaction` Transaction related information, this field contains `TxData` and `bc.Tx` parts:
  - `TxData` The part of the transaction data that is displayed to the user and is visible to the user.
    - `Version` The transaction version
    - `SerialisedSize` The size of the transaction after serialisation.
    - `TimeRange` The maximum timestamp (block height) at which the transaction will be committed to the chain (after the main chain block height reaches this timestamp (block height), if the transaction is not committed to the chain, the transaction will be invalidated)
    - `Inputs` Transaction inputs
    - `Outputs` Transaction outputs
  - `bc.Tx` indicates the conversion structure used to process transactions in the system, this part is not visible to the user and is not described in detail.
- `SigningInstructions` Signing information for the transaction.
  - `Position` The position of the signature on the `input action`.
  - `WitnessComponents` The data information needed to sign the `input action`, where `signatures` of the build transaction is `null`, which means there is no signature; if the transaction is signed successfully, the signature information will exist in this field. This field is an interface interface and contains 3 different types:
    - `SignatureWitness` hashes the contract program at the transaction `input action` position in the transaction template `Template`, and then signs the hash value.
      - `signatures` (array type) signatures for the transaction, the value exists only after the `sign-transaction` has been executed
      - `keys` (array type) contains the master public key `xpub` and the derivation path `derivation_path`, through which the corresponding derivation private key `child_xprv` can be found during the signing phase, and then the derivation private key can be used to sign the transaction.
      - The number of `quorum` account `keys` must be equal to the length of `keys` above. If `quorum` is equal to 1, it is a single-signature account, otherwise it is a multi-signature account.
      - `program` The data part of the signature, the hash value of `program` is used as the signature data. If `program` is empty, a hash is generated based on the current transaction ID and the InputID of the corresponding action location, and then a `program` is automatically constructed from them as the command data. 
    - `RawTxSigWitness` hashes the transaction ID of the transaction template `Template` and the InputID of the corresponding `input action` location (which is located in bc.Tx), and then signs the hash value.
      - `signatures` (array type) signatures for the transaction, the value exists only after the `sign-transaction` has completed execution
      - `keys` (array type) contains the master public key `xpub` and the derivation path `derivation_path`, through which the corresponding derivation private key `child_xprv` can be found during the signing phase, and then the derivation private key can be used to sign the transaction.
      - The number of `quorum` account `keys` must be equal to the length of `keys` above. If `quorum` is equal to 1, it is a single-signature account, otherwise it is a multi-signature account.
    - `DataWitness` This type does not require a signature, but verifies additional data on the contract program.
- `AllowAdditional` If `true`, additional data will be added to the transaction, but will not affect the executed `program` script of the transaction, and will have no effect on the signature result; if `false`, the whole transaction is signed as a whole, and any data changes will affect the signature of the whole transaction. Signature of the whole transaction

---

### Estimate transaction gas

The estimate-transaction-gas interface `estimate-transaction-gas` is an estimate of the handling fee for the result of a `build-transaction`. The estimated total handling fee `total_neu` needs to be added to the request structure of the `build-transaction`, and then the transaction is signed and submitted. The main flow is as follows:
```
  build - estimate - build - sign - submit
```

The input request json format for estimating the handling fee is as follows:
```js
{
  "transaction_template": {
    "allow_additional_actions": false,
    "fee": 20000000,
    "raw_transaction": "070100020161015f1190c60818b4aff485c865113c802942f29ce09088cae1b117fc4c8db2292212ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8099c4d599010001160014a86c83ee12e6d790fb388345cc2e2b87056a077301000161015fb018097c4040c8dd86d95611a13c24f90d4c9d9d06b25f5c9ed0556ac8abd73442275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f80a094a58d1d0101160014068840e56af74038571f223b1c99f1b60caaf456010003013effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff80bfffcb9901011600140b946646626c55a52a325c8bb48de792284d9b7200013e42275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f9d9f94a58d1d01160014c8b4391bab4923a83b955170d24ee4ca5b6ec3fb00013942275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f6301160014366b275ed9b2266b645cf1b8be51009cc3b260e100",
    "signing_instructions": [
      {
        "position": 0,
        "witness_components": [
          {
            "keys": [
              {
                "derivation_path": [
                  "010100000000000000",
                  "0100000000000000"
                ],
                "xpub": "de0db655c091b2838ccb6cddb675779b0a9a4204b122e61699b339867dd10eb0dbdc926882ff6dd75c099c181c60d63eab0033a4b0a4d0a8c78079e39d7ad1d8"
              }
            ],
            "quorum": 1,
            "signatures": null,
            "type": "raw_tx_signature"
          },
          {
            "type": "data",
            "value": "d174db6506e35f2decb5be148c2984bfd0f6c67f043365bf642d1af387c04fd5"
          }
        ]
      },
      {
        "position": 1,
        "witness_components": [
          {
            "keys": [
              {
                "derivation_path": [
                  "010100000000000000",
                  "0800000000000000"
                ],
                "xpub": "de0db655c091b2838ccb6cddb675779b0a9a4204b122e61699b339867dd10eb0dbdc926882ff6dd75c099c181c60d63eab0033a4b0a4d0a8c78079e39d7ad1d8"
              }
            ],
            "quorum": 1,
            "signatures": null,
            "type": "raw_tx_signature"
          },
          {
            "type": "data",
            "value": "05cdbcc705f07ad87521835bbba226ad7b430cc24e5e3f008edbe61540535419"
          }
        ]
      }
    ]
  }
}
```

The source code of the corresponding response object is as follows:
```go
type request struct{
	TxTemplate txbuilder.Template `json:"transaction_template"`
}

// Template represents a partially- or fully-signed transaction.
type Template struct {
	Transaction         *types.Tx             `json:"raw_transaction"`
	SigningInstructions []*SigningInstruction `json:"signing_instructions"`

	// AllowAdditional affects whether Sign commits to the tx sighash or
	// to individual details of the tx so far. When true, signatures
	// commit to tx details, and new details may be added but existing
	// ones cannot be changed. When false, signatures commit to the tx
	// as a whole, and any change to the tx invalidates the signature.
	AllowAdditional bool `json:"allow_additional_actions"`
}
```
The `TxTemplate` fields are described in the build-transaction result description.

The json result returned after a successful call to the `estimate-transaction-gas` interface is as follows:
```js
{
  "total_neu": 5000000,
  "storage_neu": 3840000,
  "vm_neu": 1419000
}
```

The source code of the corresponding response object is as follows:
```go
// EstimateTxGasResp estimate transaction consumed gas
type EstimateTxGasResp struct {
	TotalNeu   int64 `json:"total_neu"`
	StorageNeu int64 `json:"storage_neu"`
	VMNeu      int64 `json:"vm_neu"`
}
```

The structure fields are described below:
- `TotalNeu` The estimated total handling fee (in neu), this value is added directly to the EY asset input action of build-transaction
- `StorageNeu` The handling fee for the storage transaction.
- `VMNeu` The fee for running the virtual machine.

---

## 2. sign-transaction
API interface sign-transaction, code [api/hsm.go#L53](https://github.com/EIYARO-Project/core/blob/main/api/hsm.go#L53)

The input request json format of the signature transaction is as follows:
```js
{
  "password": "123456",
  "transaction": {
    "allow_additional_actions": false,
    "fee": 20000000,
    "raw_transaction": "070100020161015f1190c60818b4aff485c865113c802942f29ce09088cae1b117fc4c8db2292212ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8099c4d599010001160014a86c83ee12e6d790fb388345cc2e2b87056a077301000161015fb018097c4040c8dd86d95611a13c24f90d4c9d9d06b25f5c9ed0556ac8abd73442275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f80a094a58d1d0101160014068840e56af74038571f223b1c99f1b60caaf456010003013effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff80bfffcb9901011600140b946646626c55a52a325c8bb48de792284d9b7200013e42275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f9d9f94a58d1d01160014c8b4391bab4923a83b955170d24ee4ca5b6ec3fb00013942275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f6301160014366b275ed9b2266b645cf1b8be51009cc3b260e100",
    "signing_instructions": [
      {
        "position": 0,
        "witness_components": [
          {
            "keys": [
              {
                "derivation_path": [
                  "010100000000000000",
                  "0100000000000000"
                ],
                "xpub": "de0db655c091b2838ccb6cddb675779b0a9a4204b122e61699b339867dd10eb0dbdc926882ff6dd75c099c181c60d63eab0033a4b0a4d0a8c78079e39d7ad1d8"
              }
            ],
            "quorum": 1,
            "signatures": null,
            "type": "raw_tx_signature"
          },
          {
            "type": "data",
            "value": "d174db6506e35f2decb5be148c2984bfd0f6c67f043365bf642d1af387c04fd5"
          }
        ]
      },
      {
        "position": 1,
        "witness_components": [
          {
            "keys": [
              {
                "derivation_path": [
                  "010100000000000000",
                  "0800000000000000"
                ],
                "xpub": "de0db655c091b2838ccb6cddb675779b0a9a4204b122e61699b339867dd10eb0dbdc926882ff6dd75c099c181c60d63eab0033a4b0a4d0a8c78079e39d7ad1d8"
              }
            ],
            "quorum": 1,
            "signatures": null,
            "type": "raw_tx_signature"
          },
          {
            "type": "data",
            "value": "05cdbcc705f07ad87521835bbba226ad7b430cc24e5e3f008edbe61540535419"
          }
        ]
      }
    ]
  }
}
```

The source code of the corresponding request object is as follows:
```go
type SignRequest struct {    //function pseudohsmSignTemplates request
	Password string             `json:"password"`
	Txs      txbuilder.Template `json:"transaction"`
}
```

The structure fields are described below:
- `Password` The password for signing, based on which the user's private key can be parsed from the node server, and then the transaction can be signed with the private key
- `Txs` Transaction template, the result of build-transaction, structure type is `txbuilder.Template`, the related fields are described in the result of build-transaction.

The json result returned after a successful `sign-transaction` request is as follows:
```js
{
  "sign_complete": true,
  "transaction": {
    "allow_additional_actions": false,
    "fee": 20000000,
    "raw_transaction": "070100020161015f1190c60818b4aff485c865113c802942f29ce09088cae1b117fc4c8db2292212ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8099c4d599010001160014a86c83ee12e6d790fb388345cc2e2b87056a0773630240273d5fc4fb06909fbc2968ea91c411fd20f690c88e74284ce2732052400129948538562fe432afd6cf17e590e8645b80edf80b9d9581d0a980d5f9f859e3880620d174db6506e35f2decb5be148c2984bfd0f6c67f043365bf642d1af387c04fd50161015fb018097c4040c8dd86d95611a13c24f90d4c9d9d06b25f5c9ed0556ac8abd73442275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f80a094a58d1d0101160014068840e56af74038571f223b1c99f1b60caaf4566302400cf0beefceaf9fbf1efadedeff7aee5b38ee7a25a20d78b630b01613bc2f8c9230555a6e09aaa11a82ba68c0fc9e98a47c852dfe3de851d93f9b2b7ce256f90d2005cdbcc705f07ad87521835bbba226ad7b430cc24e5e3f008edbe6154053541903013effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff80bfffcb9901011600140b946646626c55a52a325c8bb48de792284d9b7200013e42275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f9d9f94a58d1d01160014c8b4391bab4923a83b955170d24ee4ca5b6ec3fb00013942275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f6301160014366b275ed9b2266b645cf1b8be51009cc3b260e100",
    "signing_instructions": [
      {
        "position": 0,
        "witness_components": [
          {
            "keys": [
              {
                "derivation_path": [
                  "010100000000000000",
                  "0100000000000000"
                ],
                "xpub": "de0db655c091b2838ccb6cddb675779b0a9a4204b122e61699b339867dd10eb0dbdc926882ff6dd75c099c181c60d63eab0033a4b0a4d0a8c78079e39d7ad1d8"
              }
            ],
            "quorum": 1,
            "signatures": [
              "273d5fc4fb06909fbc2968ea91c411fd20f690c88e74284ce2732052400129948538562fe432afd6cf17e590e8645b80edf80b9d9581d0a980d5f9f859e38806"
            ],
            "type": "raw_tx_signature"
          },
          {
            "type": "data",
            "value": "d174db6506e35f2decb5be148c2984bfd0f6c67f043365bf642d1af387c04fd5"
          }
        ]
      },
      {
        "position": 1,
        "witness_components": [
          {
            "keys": [
              {
                "derivation_path": [
                  "010100000000000000",
                  "0800000000000000"
                ],
                "xpub": "de0db655c091b2838ccb6cddb675779b0a9a4204b122e61699b339867dd10eb0dbdc926882ff6dd75c099c181c60d63eab0033a4b0a4d0a8c78079e39d7ad1d8"
              }
            ],
            "quorum": 1,
            "signatures": [
              "0cf0beefceaf9fbf1efadedeff7aee5b38ee7a25a20d78b630b01613bc2f8c9230555a6e09aaa11a82ba68c0fc9e98a47c852dfe3de851d93f9b2b7ce256f90d"
            ],
            "type": "raw_tx_signature"
          },
          {
            "type": "data",
            "value": "05cdbcc705f07ad87521835bbba226ad7b430cc24e5e3f008edbe61540535419"
          }
        ]
      }
    ]
  }
}
```

The source code of the corresponding response object is as follows:
```go
type signResp struct {
	Tx           *txbuilder.Template `json:"transaction"`
	SignComplete bool                `json:"sign_complete"`
}
```

The structure fields are described below:
- `Tx` Transaction template after signing `txbuilder.Template`, if the signature is successful then `signatures` will be changed from null to the value of the signature, and the length of `raw_transaction` will be longer, because the `bc.Tx` part adds the parameter information for verifying the signature.
- `SignComplete` Signature completion flag, if it is `true` means the signature is complete, otherwise it is `false` means the signature is not complete, if it is a single signature, it may be a wrong password for the signature; if it is multiple signatures, it may be a need for other signatures. In case of signature failure, you just need to re-sign the signed transaction data with the correct password, no need to build the transaction again with `build-transaction`.

---

## 3. Submit transaction
API interface submit-transaction, code [api/transact.go#L132](https://github.com/EIYARO-Project/core/blob/main/api/transact.go#L132)

The input request json format for submit-transaction is as follows:
```js
{
  "raw_transaction": "070100020161015f1190c60818b4aff485c865113c802942f29ce09088cae1b117fc4c8db2292212ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8099c4d599010001160014a86c83ee12e6d790fb388345cc2e2b87056a0773630240273d5fc4fb06909fbc2968ea91c411fd20f690c88e74284ce2732052400129948538562fe432afd6cf17e590e8645b80edf80b9d9581d0a980d5f9f859e3880620d174db6506e35f2decb5be148c2984bfd0f6c67f043365bf642d1af387c04fd50161015fb018097c4040c8dd86d95611a13c24f90d4c9d9d06b25f5c9ed0556ac8abd73442275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f80a094a58d1d0101160014068840e56af74038571f223b1c99f1b60caaf4566302400cf0beefceaf9fbf1efadedeff7aee5b38ee7a25a20d78b630b01613bc2f8c9230555a6e09aaa11a82ba68c0fc9e98a47c852dfe3de851d93f9b2b7ce256f90d2005cdbcc705f07ad87521835bbba226ad7b430cc24e5e3f008edbe6154053541903013effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff80bfffcb9901011600140b946646626c55a52a325c8bb48de792284d9b7200013e42275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f9d9f94a58d1d01160014c8b4391bab4923a83b955170d24ee4ca5b6ec3fb00013942275aacbeda1522cd41580f875c3c452daf5174b17ba062bf0ab71a568c123f6301160014366b275ed9b2266b645cf1b8be51009cc3b260e100"
}
```

The request object corresponding to the source code is as follows:
```go
type SubmitRequest struct { //function submit request
	Tx types.Tx `json: "raw_transaction"`
}
```

The struct fields are described below:
- `Tx` Information about the transaction after the signature is complete. Note that the `raw_transaction` in this field is not the full return result of the signature transaction `sign-transaction`, but rather the `raw_transaction` field in the `transaction` in the return result of the signature transaction.

The json result returned after a successful `sign-transaction` request is as follows:
``js.
{
  "tx_id": "2c0624a7d251c29d4d1ad14297c69919214e78d995affd57e73fbf84ece361cd"
}
```

The response object corresponding to the source code is as follows:
```go
type submitTxResp struct {
	TxID *bc.Hash `json: "tx_id"`
}
```

The structure fields are described below:
- `TxID` The transaction ID, which is displayed when the transaction has been submitted to the pool, otherwise the transaction fails.
